var Auth={_VERSION:"1.2",login:function(login,password,remember,btn){return login=void 0===login&&0!==$("#login_credential").val().length?$("#login_credential").val():$("#login_credential_form").val(),password=void 0===password&&0!==$("#login_password").val().length?$("#login_password").val():$("#login_password_form").val(),remember=void 0===remember&&$("#login_remember_me").is(":checked")?$("#login_remember_me").is(":checked"):$("#login_remember_me_form").is(":checked"),btn=void 0===btn?$("#loginBtn"):btn,console.log("Auth.login("+login+", ******, "+(remember?1:0)+")"),0===login.length?Utils.notify("Введите почтовый ящик","warning",4e3):0===password.length?Utils.notify("Введите пароль","warning",4e3):(btn.button("loading"),void requestHandler.ajaxRequest("/api/user/auth",{login:login,password:password,silent:!1,remember:remember,referer:window.location.href},function(result){switch(btn.button("reset"),result.status){case"success":!1===result.redirect?location.reload():location.href=result.redirect;break;case"throttle":Utils.notify("Вы исчерпали лимит попыток входа в аккаунт<br>Попробуйте завтра","error",4e3);break;case"wrongCredentials":Utils.notify("Не корректный логин или пароль<br>После 5 попыток IP адрес будет временно заблокирован","warning",7e3)}}))},register:function(username,email,password,terms,captcha){if(username=void 0===username?$("#register_nickname").val():username,email=void 0===email?$("#register_email").val():email,password=void 0===password?$("#register_password").val():password,terms=void 0===terms?$("#register_terms"):terms,"google"===Utils.captcha_type?captcha=void 0===captcha?$("#g-recaptcha-response").val():captcha:"off"===Utils.captcha_type?captcha=null:(console.error("Auth.restorePassword Unknown captcha type!"),captcha=null),console.log("Auth.register("+username+", "+email+", ******, "+(terms.is(":checked")?1:0)+")"),console.log("Captcha response: "+captcha),"google"===Utils.captcha_type&&"undefined"==typeof grecaptcha&&console.warn("Auth.register grecaptcha not defined!"),"off"!==Utils.captcha_type&&(void 0===captcha||""===captcha))return Utils.notify("Пройдите проверку что вы не робот","warning",4e3);var btn=$("#postbut");return username.length<3?Utils.notify("Введите Имя пользователя","warning",4e3):0===email.length?Utils.notify("Введите почтовый ящик","warning",4e3):0===password.length?Utils.notify("Введите пароль","warning",4e3):password.length<6?Utils.notify("Минимальная длина пароля 6 символов","warning",4e3):terms.is(":checked")?(btn.button("loading"),void requestHandler.ajaxRequest("/api/user/register",{email:email,username:username,password:password,"captcha-response":captcha},function(result){switch(btn.button("reset"),"success"!==result.status&&"activationSentError"!==result.status&&"google"===Utils.captcha_type&&grecaptcha.reset(),result.status){case"success":case"activationSentError":location.href=result.redirect;break;case"wrongCaptcha":Utils.notify("Не корректная капча","warning");break;case"usernameChar":Utils.notify("Недопустимые символы в имени пользователя","warning");break;case"usernameLength":Utils.notify("Слишком длинный ник","warning");break;case"usernameExists":Utils.notify("Пользователь с таким именем уже существует","warning");break;case"onlyOneLang":Utils.notify("Имя пользователя должно быть только на одном языке","warning");break;case"emailExists":Utils.notify("Пользователь с таким почтовым ящиком уже существует","warning");break;case"invalidEmail":Utils.notify("Не корректный почтовый ящик","warning");break;case"ipThrottle":Utils.notify("Установлен лимит на регистрацию с одного IP в сутки<br>Вы сможете зерегистрироваться через "+result.timeleft,"warning");break;case"declinedEmailProvider":Utils.notify("Данный Email провайдер запрещен для регистрация","warning");break;case"whiteList":Utils.notify("Регистрация с данного почтового сервиса запрещена","warning"),$("#allowed-providers-block").show(),$("#allowed-providers").html(result.allowed.join(", "));break;case"wrongCaptchaResponse":Utils.notify("Похоже на то что вы робот :(","warning");break;case"alreadyRegistered":location.href="/"+Utils.prefix}})):Utils.notify("Вы не приняли Условия и Правила форума","warning",4e3)},restorePassword:function(credential,captcha,btn){return credential=void 0===credential?$("#restore_password_credential").val():credential,"google"===Utils.captcha_type?captcha=void 0===captcha?$("#g-recaptcha-response").val():captcha:"off"===Utils.captcha_type?captcha=null:(console.error("Auth.restorePassword Unknown captcha type!"),captcha=null),console.log("Auth.restorePassword("+credential+", captcha, btn)"),"off"===Utils.captcha_type||void 0!==captcha&&""!==captcha?(btn=void 0===btn?$("#restoreBtn"):btn,credential.length<3?Utils.notify("Введите Имя пользователя или Почтовый ящик","warning",4e3):(btn.button("loading"),void requestHandler.ajaxRequest("/api/user/restorePassword",{credentials:credential,"captcha-response":captcha},function(result){switch(btn.button("reset"),Auth.resetCaptcha(),result.status){case"success":if(result.error&&"recoverySentError"===result.error)return Utils.notify("Письмо с кодом восстановления не было отправлено из-за ошибки<br>Повторите попытку позже","warning",1e4),void setTimeout(function(){location.href="/"+Utils.prefix},7800);Utils.notify("Письмо с кодом восстановления отправлено Вам на почту","info",8e3),setTimeout(function(){location.href="/"+Utils.prefix},7800);break;case"alreadyLogged":location.href="/"+Utils.prefix;break;case"wrongCaptcha":Utils.notify("Не корректная капча","warning");break;case"wrongCredentials":Utils.notify("Данного пользователя не существует","warning");break;case"wrongCaptchaResponse":Utils.notify("Похоже на то что вы робот :(","warning");break;case"emailThrottle":Utils.notify("Превышен лимит восстановления пароля для почтового ящика<br>Лимит "+result.limit+" раза в 24 часа");break;case"ipThrottle":Utils.notify("Превышен лимит восстановления пароля для IP<br>Лимит "+result.limit+" раз в 24 часа");break;case"invalidEmail":Utils.notify("Не корректный почтовый ящик","warning");break;default:Utils.notify("Произошла ошибка при восстановлении","warning")}}))):Utils.notify("Пройдите проверку что вы не робот","warning",4e3)},resetPassword:function(password,repeatPassword,code,button){if(password=password||document.querySelector("#restore_password").value,repeatPassword=repeatPassword||document.querySelector("#restore_password_repeat").value,code=code||document.querySelector("#code").value,button=button||$("#restoreBtn"),password.length<6)return Utils.notify("Минимальная длина пароля составляет 6 символов","warning",4e3);if(password!==repeatPassword)return Utils.notify("Пароли не совпадают","warning",4e3);var data={password:password,repeatPassword:repeatPassword,code:code};button.button("loading"),requestHandler.ajaxRequest("/api/user/resetPassword",data,function(response){switch(button.button("reset"),response.status){case"success":location.href="/";break;case"alreadyLogged":location.href="/"+Utils.prefix;break;case"passwordsAreDifferent":Utils.notify("Пароли отличаются","warning");break;case"userNotFound":case"invalidUser":Utils.notify("Пользователь не найден","warning");break;default:Utils.notify("Произошла ошибка при восстановлении","warning")}})},resetCaptcha:function(){"google"===Utils.captcha_type&&grecaptcha.reset()},init:function(){console.log("[Auth] Init. Captcha type: "+Utils.captcha_type+". Version "+this._VERSION)}};$(document).ready(function(){Auth.init()});